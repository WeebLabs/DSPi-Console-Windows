<Window
    x:Class="DSPiConsole.LoudnessWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    Title="Loudness Compensation">

    <Grid Background="{ThemeResource ApplicationPageBackgroundThemeBrush}" Padding="20">
        <ScrollViewer VerticalScrollBarVisibility="Auto">
            <StackPanel Spacing="16">
                <!-- Header: title on left, toggle on right -->
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <FontIcon Glyph="&#xE767;" FontSize="16" VerticalAlignment="Center" Margin="0,0,8,0"/>

                    <StackPanel Grid.Column="1" VerticalAlignment="Center">
                        <TextBlock Text="Loudness Compensation" FontSize="16" FontWeight="SemiBold"/>
                        <TextBlock Text="ISO 226 equal-loudness contour correction"
                                   FontSize="11" Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                    </StackPanel>

                    <ToggleSwitch x:Name="EnableToggle" Grid.Column="2" OnContent="On" OffContent="Off"
                                  Toggled="OnEnableToggled" MinWidth="0" HorizontalAlignment="Right"
                                  VerticalAlignment="Center"/>
                </Grid>

                <!-- Compensation Curve with axes -->
                <Border CornerRadius="8" Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                        BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}" BorderThickness="1"
                        Padding="0">
                    <Grid Height="180">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="36"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="*"/>
                            <RowDefinition Height="20"/>
                        </Grid.RowDefinitions>

                        <!-- Y-axis labels -->
                        <Canvas x:Name="YAxisCanvas" Grid.Column="0" Grid.Row="0"/>

                        <!-- Plot area -->
                        <Canvas x:Name="CurveCanvas" Grid.Column="1" Grid.Row="0" Margin="0,8,8,0"/>

                        <!-- X-axis labels -->
                        <Canvas x:Name="XAxisCanvas" Grid.Column="1" Grid.Row="1" Margin="0,0,8,0"/>
                    </Grid>
                </Border>

                <Border Height="1" Background="{ThemeResource DividerStrokeColorDefaultBrush}"/>

                <!-- Reference SPL -->
                <StackPanel Spacing="4">
                    <TextBlock Text="Reference SPL" FontWeight="Medium"/>
                    <TextBlock Text="Calibrated SPL at your typical listening level."
                               FontSize="11" Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        <Slider x:Name="RefSPLSlider" Minimum="40" Maximum="100" StepFrequency="1"
                                ValueChanged="OnRefSPLChanged"/>
                        <StackPanel Grid.Column="1" Orientation="Horizontal" Spacing="4" Margin="8,0,0,0">
                            <TextBox x:Name="RefSPLTextBox" Width="50" TextChanged="OnRefSPLTextChanged"/>
                            <TextBlock Text="dB" VerticalAlignment="Center"
                                       Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                        </StackPanel>
                    </Grid>
                </StackPanel>

                <!-- Intensity -->
                <StackPanel Spacing="4">
                    <TextBlock Text="Intensity" FontWeight="Medium"/>
                    <TextBlock Text="100% = standard ISO 226 compensation."
                               FontSize="11" Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        <Slider x:Name="IntensitySlider" Minimum="0" Maximum="200" StepFrequency="1"
                                ValueChanged="OnIntensityChanged"/>
                        <StackPanel Grid.Column="1" Orientation="Horizontal" Spacing="4" Margin="8,0,0,0">
                            <TextBox x:Name="IntensityTextBox" Width="50" TextChanged="OnIntensityTextChanged"/>
                            <TextBlock Text="%" VerticalAlignment="Center"
                                       Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                        </StackPanel>
                    </Grid>
                </StackPanel>
            </StackPanel>
        </ScrollViewer>
    </Grid>
</Window>
